@page "/blogs"
@inject HttpClient HttpClient
@inject AppState AppState
@inject IJSRuntime JS

@if (blogs == null || blogs.Count <= 0)
{
    <p><em>Loading...</em></p>
}
else
{
    <MatTable Items="@blogs">
        <MatTableHeader>
            <th>Id</th>
            <th>Title</th>
            <th>Desc</th>
        </MatTableHeader>
        <MatTableRow>
            <td>@context.Id</td>
            <td>@context.Title</td>
            <td>@context.Description</td>
        </MatTableRow>
    </MatTable>
}

@code {

    List<BlogDto> blogs = new List<BlogDto>();

    protected override async Task OnInitAsync()
    {
        AppState.SetUserInfo(await JS.GetUserInfoAsync()); // todo: fix later

        var id = Guid.NewGuid();
        var token = AppState.UserInfo.AccessToken;
        HttpClient.DefaultRequestHeaders.Remove("Authorization");
        HttpClient.DefaultRequestHeaders.Add("Authorization", $"Bearer {token}");
        var response = await HttpClient.GetProtobufAsync<PaginatedBlogDto>($"api/blogs?page=1");

        blogs = new List<BlogDto>();
        blogs.AddRange(response.Items);

        this.StateHasChanged();
    }
}